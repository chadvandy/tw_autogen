<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
	<title>Narrative Events script class</title>
	<link rel="stylesheet" href="../stylesheet.css" type="text/css" />
</head>

<body>

	<a name="top"></a>

	<div id="container">

		<div style="background-color:#fff7cc" id="main">

			<div style="background-color:#fff7cc" id="navigation_left">
				<br/>
				<h1 class="navigation_header"><i>Campaign Documentation</i></h1>
				<a href="../index.html">Scripting Homepage</a>
				<h2 style="background-color:#ffed8c">Search</h2>
				<ul>
				<form id="search_env_checkbox" class="search_env_checkbox">
					<label for="search_current_env_only">Search campaign only</label>
					<input type="checkbox" name="search_current_env_only" checked /><br />
				</form>
				<form id="search" class="search_form" onsubmit="return false">
					<input class="search_input" type="text" placeholder="Search.."/><br />
					<div id="search_dropdown" class="search_dropdown"></div>
				</form>				<h2 style="background-color:#ffed8c">Game Areas</h2>
				<ul>
					<li><strong> > Campaign Index</strong></li>
					<li><a href="../battle/battle_index.html">Battle Index</a></li>
					<li><a href="../frontend/frontend_index.html">Frontend Index</a></li>
				</ul>

				<h2 style="background-color:#ffed8c">On this page</h2>
				<ul>
				<div class="key">
					<strong>Key</strong>
					<table class="key">
						<tr>
							<td width="75%">Loaded in Campaign</td>
							<td><img alt="Loaded in Campaign" style="float:right;" src="../images/loaded_in_campaign.png" height="10" width="10" /></td>
						</tr>
						<tr>
							<td width="75%">Loaded in Battle</td>
							<td><img alt="Loaded in Battle" style="float:right;" src="../images/loaded_in_battle.png" height="10" width="10" /></td>
						</tr>
						<tr>
							<td width="75%">Loaded in Frontend</td>
							<td><img alt="Loaded in Frontend" style="float:right;" src="../images/loaded_in_frontend.png" height="10" width="10" /></td>
						</tr>
						</table>
				</div>
					<li><a href="#class:narrative_event">Narrative Events</a><img alt="Loaded in Campaign" style="float:right; margin-right:1em;" src="../images/loaded_in_campaign.png" height="10" width="10" /></li>
					<ul>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Creation">Creation</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:new">new</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Usage">Usage</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Querying">Querying</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:is_running">is_running</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:has_triggered_this_campaign">has_triggered_this_campaign</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:has_been_seen_in_advice_history">has_been_seen_in_advice_history</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Scripted Objectives">Scripted Objectives</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_new_objective">add_new_objective</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_condition">add_condition</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_payload">add_payload</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_mission_issuer">set_mission_issuer</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:get_mission_manager">get_mission_manager</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Payload Inheritance">Payload Inheritance</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_narrative_event_payload_inheritance">add_narrative_event_payload_inheritance</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Scripted Messages">Scripted Messages</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_message_on_issued">add_message_on_issued</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_message_on_mission_completed">add_message_on_mission_completed</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Trigger Callbacks">Trigger Callbacks</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_trigger_callback">set_trigger_callback</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Narrative Event Categories">Narrative Event Categories</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_category">set_category</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Intervention Priority">Intervention Priority</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_priority">set_priority</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Camera Scrolling">Camera Scrolling</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_camera_scroll_target_callback">set_camera_scroll_target_callback</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Preconditions">Preconditions</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_precondition">add_precondition</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:remove_precondition">remove_precondition</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Advice Preconditions">Advice Preconditions</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_advice_precondition">add_advice_precondition</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:remove_advice_precondition">remove_advice_precondition</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Trigger Conditions">Trigger Conditions</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_trigger_condition">add_trigger_condition</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:remove_trigger_condition">remove_trigger_condition</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Force No Intervention">Force No Intervention</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:set_force_no_intervention">set_force_no_intervention</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Intervention Configuration">Intervention Configuration</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:add_intervention_configuration_callback">add_intervention_configuration_callback</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_event:Starting">Starting</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_event:start">start</a></li>
					</ul>
					<li><a href="#class:narrative_query">Narrative Queries</a><img alt="Loaded in Campaign" style="float:right; margin-right:1em;" src="../images/loaded_in_campaign.png" height="10" width="10" /></li>
					<ul>
						<li>&emsp;&emsp;<a href="#section:narrative_query:Creation">Creation</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_query:new">new</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_query:Usage">Usage</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_query:Starting">Starting</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_query:start">start</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_query:Deferring">Deferring</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_query:defer">defer</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_query:retrigger">retrigger</a></li>
					</ul>
					<li><a href="#class:narrative_trigger">Narrative Triggers</a><img alt="Loaded in Campaign" style="float:right; margin-right:1em;" src="../images/loaded_in_campaign.png" height="10" width="10" /></li>
					<ul>
						<li>&emsp;&emsp;<a href="#section:narrative_trigger:Deferred Triggering">Deferred Triggering</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_trigger:Start and Cancel Messages">Start and Cancel Messages</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_trigger:Creation">Creation</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:new">new</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_trigger:Usage">Usage</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_trigger:Querying">Querying</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:has_triggered_this_campaign">has_triggered_this_campaign</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_trigger:Configuration">Configuration</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:add_monitor_event">add_monitor_event</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:add_monitor_message">add_monitor_message</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:set_should_setup_cancel_listeners_with_start_listeners"><div class="tooltip_container">set_should_setup_cancel_listeners_with_start_lis...<span style="background-color:#fff7cc"  class="tooltip_text">set_should_setup_cancel_listeners_with_start_listeners</span></div></a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:add_start_callback">add_start_callback</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:add_stop_callback">add_stop_callback</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_trigger:Starting">Starting</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:start">start</a></li>
						<li>&emsp;&emsp;<a href="#section:narrative_trigger:Manipulation">Manipulation</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:trigger_message">trigger_message</a></li>
							<li>&emsp;&emsp;&emsp;&emsp;<a href="#function:narrative_trigger:force_main_trigger">force_main_trigger</a></li>
					</ul>

				</ul>
			</div>

			<div style="background-color:#fff7cc" id="navigation_right">				<h2 style="background-color:#ffed8c">Campaign Topics</h2>
				<ul>
					<li><a href="campaign_index.html">Campaign Index</a></li>
					<li><a href="campaign_script_structure.html">Campaign Script Structure</a></li>
					<li><a href="lua.html">Lua Language</a></li>
					<li><a href="narrative_system.html">Narrative System</a></li>
					<li><a href="scripted_events.html">Scripted Events</a></li>

				</ul>

				<h2 style="background-color:#ffed8c">Game Code Interfaces</h2>
				<ul>
					<li><a href="campaignui.html">CampaignUI</a></li>
					<li><a href="cinematics.html">Cinematics</a></li>
					<li><a href="common.html">Common</a></li>
					<li><a href="episodic_scripting.html">Episodic Scripting</a></li>
					<li><a href="model_hierarchy.html">Model Hierarchy</a></li>
					<li><a href="scriptedvalueregistry.html">ScriptedValueRegistry</a></li>
					<li><a href="uicomponent.html">UIComponents</a></li>

				</ul>

				<h2 style="background-color:#ffed8c">Script Interfaces</h2>
				<ul>
					<li><a href="campaign_manager.html">Campaign Manager</a></li>
					<li><a href="core.html">Core</a></li>
					<li><a href="campaign_cutscene.html">Campaign Cutscenes</a></li>
					<li><a href="campaign_ui_manager.html">Campaign UI Manager</a></li>
					<li><a href="chapter_mission.html">Chapter Missions</a></li>
					<li><a href="convex_area.html">Convex Areas</a></li>
					<li><a href="global.html">Global</a></li>
					<li><a href="infotext_manager.html">Infotext Manager</a></li>
					<li><a href="intervention.html">Interventions</a></li>
					<li><a href="invasion_manager.html">Invasion Manager</a></li>
					<li><a href="mission_manager.html">Mission Managers</a></li>
					<li><a href="movie_overlay.html">Movie Overlays</a></li>
					<li><strong> > Narrative Events</strong></li>
					<li><a href="navigable_tour.html">Navigable Tours</a></li>
					<li><a href="objectives_manager.html">Objectives Manager</a></li>
					<li><a href="payload.html">Payload String Constructor</a></li>
					<li><a href="random_army_manager.html">Random Army Manager</a></li>
					<li><a href="script_messager.html">Script Messager</a></li>
					<li><a href="scripted_tour.html">Scripted Tours</a></li>
					<li><a href="text_pointer.html">Text Pointers</a></li>
					<li><a href="timer_manager.html">Timer Manager</a></li>
					<li><a href="topic_leader.html">Topic Leader</a></li>
					<li><a href="unique_table.html">Unique Table</a></li>
					<li><a href="validate.html">Validate</a></li>

				</ul>

				<h2 style="background-color:#ffed8c">Data Interfaces</h2>
				<ul>
					<li><a href="custom_starts.html">Campaign Custom Starts</a></li>
					<li><a href="faction_intro.html">Faction Intro</a></li>
					<li><a href="narrative.html">Narrative</a></li>
					<li><a href="narrative_events.html">Narrative Event Templates</a></li>
					<li><a href="narrative_queries.html">Narrative Query Templates</a></li>
					<li><a href="narrative_triggers.html">Narrative Trigger Templates</a></li>

				</ul>

				</ul>
			</div>

			<div id="content">
				<a name="class:narrative_event"><h1 class="content_header">Narrative Events</h1></a>
				<p>For an overview of the narrative events system see the <code><a href="narrative.html#class:narrative">narrative</a></code> topic page.</p>
				<p>Narrative events package a mission with some advice or narrative content, wrapped in an <code><a href="intervention.html#class:intervention">intervention</a></code>. They are designed to aid the creation of early-game missions, which commonly have to show a mission with some advice and occasionally a camera movement. They can also be used as a container to deliver other content like cutscenes, fullscreen movies etc.</p>
				<p>Once created, a narrative event may be associated with one or more a number of trigger messages that determine when it should trigger. See the <code><a href="#section:narrative_event:Trigger Conditions">Trigger Conditions</a></code> section for more information. Preconditions may be also be set which the narrative event must pass before it can trigger - see <code><a href="#section:narrative_event:Preconditions">Preconditions</a></code>. Preconditions can fire script messages when they fail.</p>
				<p>On-issued and on-mission-completed script messages may be specified - see the <code><a href="#section:narrative_event:Scripted Messages">Scripted Messages</a></code> section. Script messages may be triggered when a) the narrative event object triggers its mission/advice and b) when the mission is completed. The intention is that these may be listened for by other narrative objects, so that the completion or triggering of one leads to the triggering of another.</p>
				<p>Once set up, the listeners associated with a narrative event must be started with <code><a href="#function:narrative_event:start">narrative_event:start</a></code>.</p>
				<p>By default, narrative events will attempt to reduce the intrusiveness of advice, including not delivering the advice at all, if it's detected that the advice has been delivered before. This typically occurs when the player is experiencing the same narrative event on subsequent campaign playthroughs. See the <code><a href="#section:narrative_event:Narrative Event Categories">Narrative Event Categories</a></code> section for more information.</p>
				<p>Narrative events may be declared and supported in multiplayer mode, but their content delivery will not be wrapped in an <code><a href="intervention.html#class:intervention">intervention</a></code> and no advice will be shown.</p>
				<p>Narrative events output diagnostic information on the <code>Lua - Narrative</code> console spool.</p>
							<table class="loaded_in" style="margin-top: 1em;">
								<tr>
									<td>
										Loaded in Campaign
									</td>
									<td>
										<img alt="Loaded in Campaign" style="float:right;" src="../images/loaded_in_campaign.png" height="18" width="18" />
									</td>
								</tr>
								<tr>
									<td>
										Loaded in Battle
									</td>
									<td>
										<img alt="Loaded in Battle" style="float:right;" src="../images/loaded_in_battle.png" height="18" width="18" />
									</td>
								</tr>
								<tr>
									<td>
										Loaded in Frontend
									</td>
									<td>
										<img alt="Loaded in Frontend" style="float:right;" src="../images/loaded_in_frontend.png" height="18" width="18" />
									</td>
								</tr>
							</table>

				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Creation"><h2 class="section_header">Creation</h2></a>
				</div>
				<p>Narrative events create persistent <code><a href="mission_manager.html#class:mission_manager">mission_manager</a></code> objects internally. Due to this, narrative events need to be created before the first tick occurs - see the section in the mission manager documentation on <code><a href="mission_manager.html#section:mission_manager:Persistence">Persistence</a></code> for more information.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:new"><h3 class="function_name"><strong><code>narrative_event:new(<br />&emsp;&emsp;<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>, <br />&emsp;&emsp;<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">faction key</i><code><strong>, <br />&emsp;&emsp;[<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">advice key</i><code><strong>], <br />&emsp;&emsp;[<code><a href="lua.html#class:table">table</a></code> </strong></code><i class="parameter">infotext</i><code><strong>], <br />&emsp;&emsp;[<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">mission key</i><code><strong>], <br />&emsp;&emsp;[<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">completion message</i><code><strong>], <br />&emsp;&emsp;[<code><a href="lua.html#class:boolean">boolean</a></code> </strong></code><i class="parameter">suppress completion event</i><code><strong>]<br />)</code></strong></h3></a>
						</dt>
						<dd>
							Creates and returns a narrative event object. An advice key, infotext, and mission key may optionally be specified. Alternatively, narrative elements (e.g. cutscenes, event messages) can be triggered by adding them as an on-trigger callback using <code><a href="#function:narrative_event:set_trigger_callback">narrative_event:set_trigger_callback</a></code>.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Unique name amongst narrative event objects.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Key of faction, from the <code>factions</code> database table, to issue the content to.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Advice key to play with content, from the <code>advice_threads</code> table.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>4</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:table">table</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Infotext to issue with advice. This should be a table of strings, each specifying a record from the <code>advice_info_texts</code> table.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>5</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Key of mission record from <code>missions</code> table to issue.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>6</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Script message to trigger when the supplied mission is completed. This can also be a <code><a href="lua.html#class:table">table</a></code> of strings if multiple completion messages are desired.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>7</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:boolean">boolean</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=false</i></p>
										<p>Suppress mission completion event messages when this mission completes. This is experimental functionality.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="#class:narrative_event">narrative_event</a></code></code> narrative event</li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 132</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Usage"><h2 class="section_header">Usage</h2></a>
				</div>
				<p>A narrative event object is created and returned by calling <code><a href="#function:narrative_event:new">narrative_event:new</a></code>. Once created, functions on a <code>narrative_event</code> may be called in the form showed below.</p>

				<h4>Example - Specification:</h4>
				<div id="example_code"><code>
					 <i>&lt;narrative_event_object&gt;</i>:<i>&lt;function_name&gt;</i>(<i>&lt;args&gt;</i>)<br />
				</code></div>

				<h4>Example - Creation and Usage:</h4>
				<div id="example_code"><code>
					 -- name, faction_key, advice_key, infotext, mission_key, messages_on_mission_completed<br />
					 local ne_example = narrative_event:new(<br />
					 &emsp;&emsp;&emsp;&emsp;"example_early_game_narrative_event",<br />
					 &emsp;&emsp;&emsp;&emsp;"wh3_main_ksl_the_ice_court",<br />
					 &emsp;&emsp;&emsp;&emsp;"wh3_main_camp_early_game_example_01",<br />
					 &emsp;&emsp;&emsp;&emsp;nil,<br />
					 &emsp;&emsp;&emsp;&emsp;"wh3_main_ksl_early_game_example_mission_key_01"<br />
					 &emsp;&emsp;&emsp;&emsp;"KislevExampleMission01Completed"<br />
					 )<br />
					 <br />
					 -- calling a function on the object once created<br />
					 ne_example:add_trigger_condition(<br />
					&emsp;&emsp;&emsp;&emsp;"FactionTurnStart",<br />
					&emsp;&emsp;&emsp;&emsp;function(context)<br />
					&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;return context:faction():name() == "wh3_main_ksl_the_ice_court" and cm:turn_number() >= 3<br />
					&emsp;&emsp;&emsp;&emsp;end<br />
					 )<br />
					 <br />
					 -- start listening for the trigger condition<br />
					 ne_example:start()<br />
				</code></div>
				<div class="section_body">
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Querying"><h2 class="section_header">Querying</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:is_running"><h3 class="function_name"><strong><code>narrative_event:is_running()</code></strong></h3></a>
						</dt>
						<dd>
							Returns whether this narrative event is currently active and listening for its various trigger conditions. This becomes <code>true</code> when <code><a href="#function:narrative_event:start">narrative_event:start</a></code> is called and <code>false</code> when the narrative event triggers.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="lua.html#class:boolean">boolean</a></code></code> is running</li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 322</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:has_triggered_this_campaign"><h3 class="function_name"><strong><code>narrative_event:has_triggered_this_campaign()</code></strong></h3></a>
						</dt>
						<dd>
							Returns whether this narrative event has triggered in this campaign save.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="lua.html#class:boolean">boolean</a></code></code> has triggered</li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 330</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:has_been_seen_in_advice_history"><h3 class="function_name"><strong><code>narrative_event:has_been_seen_in_advice_history()</code></strong></h3></a>
						</dt>
						<dd>
							Returns whether this narrative event has ever been triggered in any campaign, from the advice history. This is mainly for internal use but can be called externally if required.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="lua.html#class:boolean">boolean</a></code></code> has triggered in </li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 338</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Scripted Objectives"><h2 class="section_header">Scripted Objectives</h2></a>
				</div>
				<p>If a mission key was specified in <code><a href="#function:narrative_event:new">narrative_event:new</a></code> then this mission type can be customised using the functions in this section. These call the equivalent functions on the internally-created mission manager. Alternatively, the internal mission manager may be directly accessed with <code><a href="#function:narrative_event:get_mission_manager">narrative_event:get_mission_manager</a></code>, at which point function calls may be made to it to customise the mission to be delivered.</p>
				<p>If no mission key was specified to <code><a href="#function:narrative_event:new">narrative_event:new</a></code> then no mision manager will have been generated, and these functions will produce errors and return <code>false</code>.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_new_objective"><h3 class="function_name"><strong><code>narrative_event:add_new_objective(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">objective type</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a new scripted objective to the internally-created mission manager. See <code><a href="mission_manager.html#function:mission_manager:add_new_objective">mission_manager:add_new_objective</a></code> for more information.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>objective type</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 374</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_condition"><h3 class="function_name"><strong><code>narrative_event:add_condition(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">condition</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a new condition to the mission objective most recently added with <code><a href="#function:narrative_event:add_new_objective">narrative_event:add_new_objective</a></code>. See <code><a href="mission_manager.html#function:mission_manager:add_condition">mission_manager:add_condition</a></code> for more information.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>condition</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 387</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_payload"><h3 class="function_name"><strong><code>narrative_event:add_payload(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">payload</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a new payload to the mission objective most recently added with <code><a href="#function:narrative_event:add_new_objective">narrative_event:add_new_objective</a></code>. See <code><a href="mission_manager.html#function:mission_manager:add_payload">mission_manager:add_payload</a></code> for more information.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>payload</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 400</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_mission_issuer"><h3 class="function_name"><strong><code>narrative_event:set_mission_issuer(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">issuer</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets a mission issuer for the internally-generated mission manager. See <code><a href="mission_manager.html#function:mission_manager:set_mission_issuer">mission_manager:set_mission_issuer</a></code> for more information.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>issuer</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 413</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:get_mission_manager"><h3 class="function_name"><strong><code>narrative_event:get_mission_manager()</code></strong></h3></a>
						</dt>
						<dd>
							Returns the internally-created mission manager, which can be used to further customise the mission to be generated.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="mission_manager.html#class:mission_manager">mission_manager</a></code></code> mission manager</li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 432</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Payload Inheritance"><h2 class="section_header">Payload Inheritance</h2></a>
				</div>
				<p>Narrative events may be set to inherit mission reward payloads from other narrative events, if that other narrative event has not yet triggered by the time the first does. This is to allow chains of narrative missions set up where individual missions can be bypassed without the player losing out on the reward that mission would bring.</p>
				<p>Consider two narrative events that encapsulate missions, one to recruit an agent and another to use an agent against an enemy target. Neither has yet triggered. The agent-action mission, which triggers when an agent is recruited, would naturally lead on from the first, but not in all cases - the player may be gifted an agent from an incident or other scripted event. By setting the agent-action mission to inherit the rewards of the recruit-agent mission, the rewards of the now-redundant recruit-agent mission will be rolled in to the agent-action mission, meaning the player is not penalised for having inadvertantly skipped a mission before it can trigger.</p>
				<p>If the narrative event being inherited from has already triggered then those rewards are not inherited. Should one narrative event inherit the rewards of another, that second narrative event will shut down and be unable to trigger.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_narrative_event_payload_inheritance"><h3 class="function_name"><strong><code>narrative_event:add_narrative_event_payload_inheritance(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">narrative event name</i><code><strong>, <code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">faction key</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Marks this narrative event as inheriting from another narrative event. The other narrative event is specified by the unique name and faction key supplied on creation.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>narrative event name</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>faction key</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 456</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Scripted Messages"><h2 class="section_header">Scripted Messages</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_message_on_issued"><h3 class="function_name"><strong><code>narrative_event:add_message_on_issued(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">message</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a script message that is triggered when this narrative event begins to issue. Multiple messages to be triggered can be added by calling this function multiple times. If the narrative event wraps its contents within an <code><a href="intervention.html#class:intervention">intervention</a></code> then this intervention will have started by the time these messages are triggered. This means that other scripts can respond to these messages and trigger their own interventions, which will queue up behind the intervention currently playing.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>message</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 535</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_message_on_mission_completed"><h3 class="function_name"><strong><code>narrative_event:add_message_on_mission_completed(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">message</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a script message that fires when the mission associated with this narrative event is completed, either successfully or unsuccessfully. Multiple messages to be triggered can be added by calling this function multiple times. Other scripts can listen for this message and respond accordingly.<br />
							If no mission is associated with this narrative event then this setting will have no effect.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>message</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 547</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Trigger Callbacks"><h2 class="section_header">Trigger Callbacks</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_trigger_callback"><h3 class="function_name"><strong><code>narrative_event:set_trigger_callback(<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">callback</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a callback to be called when this narrative event is triggered. This can be used to trigger narrative event actions like a cutscene or a fullscreen movie if a mission is not being triggered, or can be used to trigger actions in addition to a mission.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p>callback</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 571</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Narrative Event Categories"><h2 class="section_header">Narrative Event Categories</h2></a>
				</div>
				<p>Narrative events will not show advice, or not scroll the camera despite a scroll target being set with <code><a href="#function:narrative_event:set_camera_scroll_target_callback">narrative_event:set_camera_scroll_target_callback</a></code>, if they reason that the player has seen the content enough times before. They do this to avoid irritating the player with too much advice and too many intrusive camera movements for content that they're familiar with. The category of a scripted event and the advice level (high/low/minimal) set by the player is used to make this judgement and determine whether:</p>
				<p><ol><li>Advice should be played and the camera scrolled.</li></p>
				<p><li>Advice should be played with no camera movement.</li></p>
				<p><li>No advice or camera movement should be played.</li></ol></p>
				<p>In all cases the mission associated with the narrative event is triggered, if one was set up.</p>
				<p><table class="simple"><tr><th>Value</th><th>Description</th></tr></p>
				<p><tr><td><code>NARRATIVE_EVENT_CATEGORY_ADVICE_MANDATORY</code></td><td>Sets that the advice associated with this narrative event is mandatory and will always be played, including camera movements, even if the advice level is set to minimal. Only in multiplayer mode or if an advice precondition fails will the advice not be shown in this case. Use this setting sparingly.</td></tr></p>
				<p><tr><td><code>NARRATIVE_EVENT_CATEGORY_ADVICE_HIGH_PRIORITY</code></td><td>Sets that the advice associated with this narrative event is high-priority. The only circumstance in which a narrative event of this category would not show its advice would be if the advice level was set to minimal.</td></tr></p>
				<p><tr><td><code>NARRATIVE_EVENT_CATEGORY_ADVICE_SPECIFIC_TO_FACTION</code></td><td>Sets that the advice is normal priority, but that the advice shown is specific to the faction currently being played and not associated with the same narrative event but for different factions.</td></tr></p>
				<p><tr><td><code>NARRATIVE_EVENT_CATEGORY_ADVICE_SHARED</code></td><td>Sets that the advice is normal priority and is shared amongst many different factions for which this narrative event triggers (e.g. a particular early game mission shared between many different playable factions).</td></tr></table></p>
				<p>The values listed in the table above are defined in script as constants. The default narrative event category is <code>NARRATIVE_EVENT_CATEGORY_ADVICE_SHARED</code>.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_category"><h3 class="function_name"><strong><code>narrative_event:set_category(<code><a href="lua.html#class:number">number</a></code> </strong></code><i class="parameter">category enum</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets the category of the narrative event. Supply a constant value from the table above.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:number">number</a></code></code></p>
									</td>
									<td>
										<p>category enum</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>

							<h4>Example:</h4>
							<div id="example_code"><code>
								 ne_example:set_category(NARRATIVE_EVENT_CATEGORY_ADVICE_SPECIFIC_TO_FACTION)<br />
							</code></div>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 604</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Intervention Priority"><h2 class="section_header">Intervention Priority</h2></a>
				</div>
				<p>Should the narrative event trigger with an <code><a href="intervention.html#class:intervention">intervention</a></code>, the priority for that intervention will determine the sort order of interventions that want to trigger at that same time. The priority for each narrative event intervention is determined from the category (see <code><a href="#section:narrative_event:Narrative Event Categories">Narrative Event Categories</a></code>), with mandatory and high-priority narrative events triggering before narrative events set with other categories. Alternatively, the priority may be overridden directly with <code><a href="#function:narrative_event:set_priority">narrative_event:set_priority</a></code>.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_priority"><h3 class="function_name"><strong><code>narrative_event:set_priority(<code><a href="lua.html#class:number">number</a></code> </strong></code><i class="parameter">priority</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets the priority for the <code><a href="intervention.html#class:intervention">intervention</a></code> created by this narrative event, if one is created. If a priority is not set with this function then one is determined from the category (see <code><a href="#function:narrative_event:set_category">narrative_event:set_category</a></code>).<br />
							The supplied value should be a number between 0 (high priority) and 100 (lowest). See the <code><a href="intervention.html#class:intervention">intervention</a></code> documentation for more details.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:number">number</a></code></code></p>
									</td>
									<td>
										<p>priority</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 640</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Camera Scrolling"><h2 class="section_header">Camera Scrolling</h2></a>
				</div>
				<p>A scroll-camera target may be set with <code><a href="#function:narrative_event:set_camera_scroll_target_callback">narrative_event:set_camera_scroll_target_callback</a></code>. This specifies a target region, character or position to which the camera is scrolled when the mission and advice are shown.</p>
				<p>If the narrative event has been seen before in the advice history, it may decide not to scroll the camera even when a scroll-camera target has been set. See the <code><a href="#section:narrative_event:Narrative Event Categories">Narrative Event Categories</a></code> section for more information.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_camera_scroll_target_callback"><h3 class="function_name"><strong><code>narrative_event:set_camera_scroll_target_callback(<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">callback</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Sets a camera scroll target callback. This function will be stored and then later called when the narrative event is triggered. It should return either a <code><a href="lua.html#class:string">string</a></code>, a <code><a href="lua.html#class:number">number</a></code> or a <code><a href="lua.html#class:table">table</a></code> that specifies a scroll target for the narrative event. Note that the narrative event may decide not to scroll the camera in any case due to advice settings, in which case this function would not be called - see the documentation for <code><a href="#section:narrative_event:Narrative Event Categories">Narrative Event Categories</a></code> for more information.<br />
							If the function returns a <code><a href="lua.html#class:string">string</a></code>, a region is looked up with this key and, if found, the region's settlement is used as the camera scroll target. If no region is found then a faction is looked up with the key. If found, the closest military force from the faction to the camera is used for the scroll target.<br />
							If the function returns a <code><a href="lua.html#class:number">number</a></code> then it is assumed to be a character command queue index value. The character looked up by this cqi is used as the camera scroll target.<br />
							The function may also return an indexed <code><a href="lua.html#class:table">table</a></code> that specifies a display position e.g. <code>{100, 200}</code>.<br />
							If the function returns <code><a href="lua.html#class:nil">nil</a></code> or any of the above queries fail then no scroll target is set.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p>callback</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 671</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Preconditions"><h2 class="section_header">Preconditions</h2></a>
				</div>
				<p>Precondition checks may be added to a narrative event that it has to pass in order to trigger successfully. Once added, each precondition is checked when the narrative event is started and also when the narrative event attempts to trigger.</p>
				<p>Preconditions can be added with a name, which allows them to removed again if configuration is handled by multiple separate scripts that set a default behaviour for a particular narrative event and then customise that default.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_precondition"><h3 class="function_name"><strong><code>narrative_event:add_precondition(<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">precondition</i><code><strong>, [<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>], [<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">fail message</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Adds a precondition function.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p>Precondition function. This should be a function that returns a <code><a href="lua.html#class:boolean">boolean</a></code> value. Should the value evaluate to <code>false</code> when the precondition is called, the precondition is failed.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Name by which this precondition function may later be removed with <code><a href="#function:narrative_event:remove_precondition">narrative_event:remove_precondition</a></code>.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Script message to transmit in the event that this precondition fails. This can either be a <code><a href="lua.html#class:string">string</a></code> or an indexed <code><a href="lua.html#class:table">table</a></code> of strings if multiple messages are required.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 701</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:remove_precondition"><h3 class="function_name"><strong><code>narrative_event:remove_precondition(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Removes a previously-added precondition by name.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Name of precondition to remove.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 745</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Advice Preconditions"><h2 class="section_header">Advice Preconditions</h2></a>
				</div>
				<p>Advice precondition checks may be added to suppress the advice registered to the narrative event under certain conditions. Should an advice precondition fail when the narrative event is triggered, the advice will not be shown. The narrative event and its associated mission will still trigger, however.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_advice_precondition"><h3 class="function_name"><strong><code>narrative_event:add_advice_precondition(<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">precondition</i><code><strong>, [<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Adds an advice precondition function.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p>Advice precondition function. This should be a function that returns a <code><a href="lua.html#class:boolean">boolean</a></code> value. Should the value evaluate to <code>false</code> when the precondition is called, the precondition is failed.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Name for this advice precondition, by which it may be later removed with <code><a href="#function:narrative_event:remove_advice_precondition">narrative_event:remove_advice_precondition</a></code>.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 784</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:remove_advice_precondition"><h3 class="function_name"><strong><code>narrative_event:remove_advice_precondition(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Removes a previously-added advice precondition by name.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>name</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 827</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Trigger Conditions"><h2 class="section_header">Trigger Conditions</h2></a>
				</div>
				<p>Trigger messages must be added to a narrative event. A narrative event will only trigger when a trigger message is received. One or more trigger messages may be added with <code><a href="#function:narrative_event:add_trigger_condition">narrative_event:add_trigger_condition</a></code>.</p>
				<p>If no trigger conditions are added to a narrative event the only way it can trigger is by specifying it must trigger immediately when calling <code><a href="#function:narrative_event:start">narrative_event:start</a></code>.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_trigger_condition"><h3 class="function_name"><strong><code>narrative_event:add_trigger_condition(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">message</i><code><strong>, [<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">condition</i><code><strong>], [<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Adds a trigger message and condition. If the narrative event has been started and the supplied script message is received, and the optional condition passes, and no preconditions fail, then the narrative event will attempt to trigger.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Message name.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Conditional function to execute when the supplied message is received. The condition function will be passed the message context. If the function returns <code>true</code> then the check passes. If no function is specified then the check will always pass.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Name for this trigger listener. If specified, the trigger listener may be later removed during configuration by <code><a href="#function:narrative_event:remove_trigger_condition">narrative_event:remove_trigger_condition</a></code>.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 880</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_event:remove_trigger_condition"><h3 class="function_name"><strong><code>narrative_event:remove_trigger_condition(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Removes a previously-added trigger condition by name.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>name</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 942</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Force No Intervention"><h2 class="section_header">Force No Intervention</h2></a>
				</div>
				<p>Some narrative events may not wish an intervention to trigger at all, even in singleplayer. These narrative events would typically not display any information to the player and would be a hidden part of a greater sequence e.g. they might just set a value in the savegame or advice history and return. <code><a href="#function:narrative_event:set_force_no_intervention">narrative_event:set_force_no_intervention</a></code> can be used to force a narrative event to not bother creeating an intervention.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:set_force_no_intervention"><h3 class="function_name"><strong><code>narrative_event:set_force_no_intervention([<code><a href="lua.html#class:boolean">boolean</a></code> </strong></code><i class="parameter">value</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Forces the narrative event to not bother creating an intervention and instead trigger its contents directly, as it would in multiplayer mode. Missions associated with this narrative event will still be triggered, but associated advice will not be shown.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:boolean">boolean</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=true</i></p>
										<p>value</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 966</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Intervention Configuration"><h2 class="section_header">Intervention Configuration</h2></a>
				</div>
				<p>Some narrative events may wish to configure the <code><a href="intervention.html#class:intervention">intervention</a></code> that is created internally. This can be done by setting a configuration callback with <code><a href="#function:narrative_event:add_intervention_configuration_callback">narrative_event:add_intervention_configuration_callback</a></code>. This could be used to allow the intervention to play before a battle sequence has been completed or when a fullscreen panel is showing, for example.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:add_intervention_configuration_callback"><h3 class="function_name"><strong><code>narrative_event:add_intervention_configuration_callback(<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">callback</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a configuration callback for the <code><a href="intervention.html#class:intervention">intervention</a></code> object the narrative event may create internally (interventions are created in singleplayer mode only). If any configuration callbacks have been supplied then they are called as the intervention is created, which is generally just as it's triggered. Configuration callbacks will be passed the intervention object as a single argument, which they can then make configuration calls upon.<br />
							Setting a configuration callback allows calling scripts to tailor aspects of the intervention's presentation, such as allowing it to trigger over the top of fullscreen panels or not on the player's turn.<br />
							Multiple configuration callbacks may be added to a narrative event. They will be called in the order that they were added.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p>callback</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 992</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_event:Starting"><h2 class="section_header">Starting</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_event:start"><h3 class="function_name"><strong><code>narrative_event:start([<code><a href="lua.html#class:boolean">boolean</a></code> </strong></code><i class="parameter">trigger immediately</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Starts the narrative event listeners. If the narrative event has already triggered this campaign, or if its payload has already been inherited, then the listeners will not be started.<br />
							If the optional flag is set, the narrative event will attempt to trigger immediately on startup.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:boolean">boolean</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=false</i></p>
										<p>trigger immediately</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 1020</p>
						</dd>
					</dl>
				</div>

				<hr class="superblock_divider" />


				<a name="class:narrative_query"><h1 class="content_header">Narrative Queries</h1></a>
				<p>For an overview of the narrative events system see the <code><a href="narrative.html#class:narrative">narrative</a></code> topic page.</p>
				<p>Narrative queries represent decision points within a narrative structure. When triggered, a narrative query will run a supplied function query and may trigger script messages depending upon the result. Other narrative objects listening for those messages can then act upon the result of the query. See the page about the <code><a href="script_messager.html#class:script_messager">script_messager</a></code> for more information about script messages (they are different-but-equivalent to script events).</p>
				<p>All the data associated with a narrative query is supplied to it when it's constructed. Of particular note is the query records data structure - see the documentation of <code><a href="#function:narrative_query:new">narrative_query:new</a></code> for more information.</p>
				<p>Once constructed, a narrative query is started by calling <code><a href="#function:narrative_query:start">narrative_query:start</a></code>. This starts its internal trigger listeners.</p>
				<p>A narrative query triggers when it receives one of the trigger messages specified on creation (and the faction information contained in the message context matches the faction registered with the narrative query). At this point, all query functions supplied to the narrative event will be run, in order of registration. Each function will be passed the message context supplied to the narrative query as a first argument and the narrative query itself as a second. The query function can use the narrative query object to store data that other query functions that are about execute can read, if required.</p>
				<p>For any query that passes (i.e. the query function returns true) the related pass script message is triggered. Where a query doesn't pass, and a fail message was specified in the query setup, that fail message is triggered.</p>
				<p>Unlike <code><a href="#class:narrative_event">narrative_event</a></code> and <code><a href="#class:narrative_trigger">narrative_trigger</a></code> objects, narrative queries are stateless and do not save any information into the savegame. This means that any narrative query can trigger multiple times. The narrative event framework is designed so that narrative events and triggers should only be issued once, however, so this should be avoided.</p>
				<p>Narrative queries should work as expected in multiplayer mode.</p>
				<p>Narrative queries output diagnostic information on the <code>Lua - Narrative</code> console spool.</p>

				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_query:Creation"><h2 class="section_header">Creation</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_query:new"><h3 class="function_name"><strong><code>narrative_query:new(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>, <code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">faction key</i><code><strong>, <code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">trigger message</i><code><strong>, <code><a href="lua.html#class:table">table</a></code> </strong></code><i class="parameter">query records</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Creates and returns a narrative query object. As with all narrative objects a unique name and faction key to which the query applies must be supplied.<br />
							The query records table must be an indexed table containing one or more subtables. Each subtable should contain elements at the following keys:<br />
							<table class="simple"><tr><th>Key</th><th>Data Description</th></tr><br />
							<tr><td><code>message</code></td><td>Message to trigger if the related query function returns true (or a value that equates to true). This can be a single string or a table of strings if multiple pass messages are desired.</td></tr>

							<tr><td><code>fail_message</code></td><td><strong>Optional</strong> message to trigger if the related query function returns false (or a value that equates to false). This can be a single string or a table of strings if multiple pass messages are desired.</td></tr>

							<tr><td><code>query</code></td><td>A function that should return a boolean value which determines whether the query passes or fails. The function will be passed two arguments:<ol><li>The context of the message which triggered the narrative query.</li><li>The narrative query object itself.</li></td></tr>

							</table><br />
							See the <code><a href="#section:narrative_event:Usage">Usage</a></code> section of this documentation for a declaration example.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Unique name amongst narrative query objects.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Key of faction, from the <code>factions</code> database table, this narrative query is related to.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>String name of message which triggers this narrative query. This may also be a <code><a href="lua.html#class:table">table</a></code> of multiple string message names, any of which will trigger the query.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>4</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:table">table</a></code></code></p>
									</td>
									<td>
										<p>Query records - see the function documentation for a description of the data format to supply here.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="#class:narrative_query">narrative_query</a></code></code> narrative query</li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 1616</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_query:Usage"><h2 class="section_header">Usage</h2></a>
				</div>
				<p>A narrative query object is created and returned by calling <code><a href="#function:narrative_query:new">narrative_query:new</a></code>. Once created, functions on a <code>narrative_query</code> may be called in the form showed below.</p>

				<h4>Example - Specification:</h4>
				<div id="example_code"><code>
					 <i>&lt;narrative_query_object&gt;</i>:<i>&lt;function_name&gt;</i>(<i>&lt;args&gt;</i>)<br />
				</code></div>

				<h4>Example - Creation and Usage:</h4>
				<div id="example_code"><code>
					 -- name, faction_key, trigger_messages, query_records<br />
					 local nq_advice_level = narrative_query:new(<br />
					 &emsp;&emsp;&emsp;&emsp;"advice_level",<br />
					 &emsp;&emsp;&emsp;&emsp;"wh3_main_ksl_the_ice_court",<br />
					 &emsp;&emsp;&emsp;&emsp;{"Example1", "Example2", "Example3"},<br />
					 &emsp;&emsp;&emsp;&emsp;{<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;-- all queries will be run when narrative_query triggered<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;{<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;message = "ExampleAdviceLevelHigh",<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;query = function(context, nq)<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;return common.get_advice_level() == 2<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;end<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;{,<br />
					&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;{<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;message = "ExampleAdviceLevelLow",<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;query = function(context, nq)<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;return common.get_advice_level() == 1<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;end<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;{,<br />
					&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;{<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;message = "ExampleAdviceLevelMinimal",<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;query = function(context, nq)<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;return common.get_advice_level() == 0<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;end<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;{<br />
					 &emsp;&emsp;&emsp;&emsp;}<br />
					 )<br />
					 <br />
					 -- starting the narrative query<br />
					 nq_advice_level:start()<br />
				</code></div>
				<div class="section_body">
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_query:Starting"><h2 class="section_header">Starting</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_query:start"><h3 class="function_name"><strong><code>narrative_query:start()</code></strong></h3></a>
						</dt>
						<dd>
							Starts the narrative query's listeners.


							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 1746</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_query:Deferring"><h2 class="section_header">Deferring</h2></a>
				</div>
				<p>It may be desirable for a narrative query to not immediately return a result when it is triggered, such as if a multiplayer query is run with <code><a href="campaign_manager.html#function:campaign_manager:progress_on_mp_query">campaign_manager:progress_on_mp_query</a></code>. <code><a href="#function:narrative_query:defer">narrative_query:defer</a></code> may be called while is query is actively processing to instruct the query not to act on any result at that moment. At a later time <code><a href="#function:narrative_query:retrigger">narrative_query:retrigger</a></code> may be called, which re-runs the query. In the interim, scripts can have prepared the information that the query needs to successfully complete.</p>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_query:defer"><h3 class="function_name"><strong><code>narrative_query:defer()</code></strong></h3></a>
						</dt>
						<dd>
							Defers the query, instructing it to not transmit any success or failure messages at that time. The query may be re-run with <code><a href="#function:narrative_query:retrigger">narrative_query:retrigger</a></code>.<br />
							This function may only be called from within one of the narrative query's condition callbacks.


							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 1889</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_query:retrigger"><h3 class="function_name"><strong><code>narrative_query:retrigger()</code></strong></h3></a>
						</dt>
						<dd>
							Retriggers a deferred query.


							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 1903</p>
						</dd>
					</dl>
				</div>

				<hr class="superblock_divider" />


				<a name="class:narrative_trigger"><h1 class="content_header">Narrative Triggers</h1></a>
				<p>For an overview of the narrative events system see the <code><a href="narrative.html#class:narrative">narrative</a></code> topic page.</p>
				<p>Narrative triggers monitor game conditions in order to trigger other objects within the narrative system. All narrative events, or chains of narrative events, should ultimately be started by a narrative trigger.</p>
				<p>One or more game script event/condition checks are registered with the narrative trigger either as it's created with <code><a href="#function:narrative_trigger:new">narrative_trigger:new</a></code> or later with <code><a href="#function:narrative_trigger:add_monitor_event">narrative_trigger:add_monitor_event</a></code>. When the narrative trigger is subsequently started when <code><a href="#function:narrative_trigger:start">narrative_trigger:start</a></code> is called, it starts a listener for each supplied event/condition and, if the event is received and the related condition is met, triggers one or more script messages that can start other objects in the narrative event system. Narrative triggers can also listen for script messages to know when to trigger - these can be added with <code><a href="#function:narrative_trigger:add_monitor_message">narrative_trigger:add_monitor_message</a></code> - although it's intended that narrative triggers should primarily listen for script events rather than messages.</p>
				<p>Note the distinction between script messages and script events - while narrative triggers can listen for script events and messages from the game (or other scripts) to know when to trigger, the communication with other narrative objects happens exclusively with script messages. Script messages are a script-only parallel mechanism to script events, see the <code><a href="script_messager.html#class:script_messager">script_messager</a></code> documentation for more information.</p>
				<p>In most cases, all data relevant to the narrative trigger is supplied during construction, when <code><a href="#function:narrative_trigger:new">narrative_trigger:new</a></code> is called. Additional script events/conditions to monitor can be added after creation by calling <code><a href="#function:narrative_trigger:add_monitor_event">narrative_trigger:add_monitor_event</a></code>.</p>
				<p>Once created, a narrative trigger will begin its monitors when <code><a href="#function:narrative_trigger:start">narrative_trigger:start</a></code> is called. Like narrative events and queries, narrative triggers are intended to only trigger once per-campaign playthrough. If a narrative trigger finds in the savegame data that it has triggered before it will not start its listeners when <code><a href="#function:narrative_trigger:start">narrative_trigger:start</a></code> is called.</p>
				<p>Narrative triggers should work in multiplayer mode. Narrative triggers should only listen for model game events in multiplayer mode to allow scripts on different physical machines to maintain synchronicity.</p>
				<p>Like other narrative objects, narrative triggers output diagnostic information on the <code>Lua - Narrative</code> console spool.</p>

				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_trigger:Deferred Triggering"><h2 class="section_header">Deferred Triggering</h2></a>
				</div>
				<p>Invididual event/condition pairs can be set up to trigger immediately or not. Should an event/condition pair not be set up to trigger immediately then the narrative trigger will fire its trigger messages(s) within an intervention, which means that the message may not be triggered straight away. This can help reduce the intrusiveness of the narrative event system by spacing out the delivery of narrative events over time.</p>
				<p>In multiplayer mode, where interventions are not supported, trigger messages are always fired immediately.</p>
				<div class="section_body">
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_trigger:Start and Cancel Messages"><h2 class="section_header">Start and Cancel Messages</h2></a>
				</div>
				<p>Narrative triggers may also be set up with start messages. Should one or more start message be registered then the narrative trigger will not start its main event/condition monitoring process until a start message is received from another object within the narrative event system. This can be useful in certain circumstances, for example to listen for the start of a particular faction's turn but only after another mission in the narrative event system has completed. If no start messages are specified the narrative trigger starts its main monitoring process immediately when narrative_trigger:start is called.</p>
				<p>Cancel messages may also be set up for narrative triggers. These allow other narrative objects to cancel the trigger's main monitoring process, which can be used to stop a trigger from firing if some other condition is met within the narrative event system.</p>
				<div class="section_body">
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_trigger:Creation"><h2 class="section_header">Creation</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:new"><h3 class="function_name"><strong><code>narrative_trigger:new(<br />&emsp;&emsp;<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">name</i><code><strong>, <br />&emsp;&emsp;<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">faction key</i><code><strong>, <br />&emsp;&emsp;<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">target message</i><code><strong>, <br />&emsp;&emsp;[<code><a href="lua.html#class:table">table</a></code> </strong></code><i class="parameter">main event records</i><code><strong>], <br />&emsp;&emsp;[<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">start message</i><code><strong>], <br />&emsp;&emsp;[<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">cancel messages</i><code><strong>], <br />&emsp;&emsp;[<code><a href="lua.html#class:number">number</a></code> </strong></code><i class="parameter">intervention priority</i><code><strong>]<br />)</code></strong></h3></a>
						</dt>
						<dd>
							Creates and returns a narrative trigger object. As with all narrative objects a unique name and faction key to which the trigger applies must be supplied.<br />
							The main events and conditions table must be an indexed table containing one or more subtables for each event/condition pair. Each subtable should contain elements at the following keys:<br />
							<table class="simple"><tr><th>Key</th><th>Data Description</th></tr><br />
							<tr><td><code>event</code></td><td>Game event to listen for. This should be a model event and not a UI event to prevent the game desynchronising in multiplayer mode.</td></tr>

							<tr><td><code>condition</code></td><td>Condition check to perform at the time the related event is received. This should be a <code><a href="lua.html#class:function">function</a></code> which returns a boolean value. When called, the function will be passed the event context and the narrative trigger object as two separate arguments.</p>In common with other event/condition systems elsewhere, the <code><a href="lua.html#class:boolean">boolean</a></code> value <code>true</code> may be supplied here in place of a function, in which case the condition always passes.</td></tr>

							<tr><td><code>immediate</code></td><td><strong>Optional</strong> boolean value which, if set to true, forces the narrative trigger to fire its trigger events immediately if this event/condition pair pass. If this value is false or is not supplied, the target message(s) are fired in an intervention which can delay their issue. In multiplayer mode the target message(s) are always fired immediately.</li></td></tr>

							</table><br />
							See the <code><a href="#section:narrative_event:Usage">Usage</a></code> section of this documentation for a declaration example.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Unique name amongst narrative query objects.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Key of faction, from the <code>factions</code> database table, this narrative query is related to.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>String message which this narrative trigger fires when any event/condition pair are met. This may also be a <code><a href="lua.html#class:table">table</a></code> of multiple string message names, in which case all will be triggered.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>4</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:table">table</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Main event and condition records. See the function documentation above for a description of the data format to supply here. This may be left blank, with main listeners added later using either <code><a href="#function:narrative_trigger:add_monitor_event">narrative_trigger:add_monitor_event</a></code> or <code><a href="#function:narrative_trigger:add_monitor_message">narrative_trigger:add_monitor_message</a></code>.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>5</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=false</i></p>
										<p>Message on which to start this trigger's main event monitors. This can be supplied as a single string or a <code><a href="lua.html#class:table">table</a></code> of multiple string message names.</p>
										<p>If no start messages are supplied then the narrative trigger will start its main event monitors as soon as it is started.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>6</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=false</i></p>
										<p>Narrative messages on which to cancel the narrative trigger. This can be supplied as a single string or a <code><a href="lua.html#class:table">table</a></code> of multiple string message names.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>7</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:number">number</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=60</i></p>
										<p>Priority at which to trigger the internal <code><a href="intervention.html#class:intervention">intervention</a></code> object, if one is declared. See intervention documentation for more information about intervention priorities.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="#class:narrative_trigger">narrative_trigger</a></code></code> narrative trigger</li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2060</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_trigger:Usage"><h2 class="section_header">Usage</h2></a>
				</div>
				<p>A narrative trigger object is created and returned by calling <code><a href="#function:narrative_trigger:new">narrative_trigger:new</a></code>. Once created, functions on a <code>narrative_trigger</code> may be called in the form showed below.</p>

				<h4>Example - Specification:</h4>
				<div id="example_code"><code>
					 <i>&lt;narrative_trigger_object&gt;</i>:<i>&lt;function_name&gt;</i>(<i>&lt;args&gt;</i>)<br />
				</code></div>

				<h4>Example - Creation and Usage:</h4>
				<div id="example_code"><code>
					 -- name, faction_key, target_messages, main_event_and_condition_records, start_messages, cancel_messages, intervention_priority<br />
					 local nt_player_starts_turn_ten = narrative_query:new(<br />
					 &emsp;&emsp;&emsp;&emsp;"player_starts_turn_ten",<br />
					 &emsp;&emsp;&emsp;&emsp;"wh3_main_ksl_the_ice_court",<br />
					 &emsp;&emsp;&emsp;&emsp;"ScriptEventPlayerStartsTurnTen",<br />
					 &emsp;&emsp;&emsp;&emsp;{<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;{<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;event = "ScriptEventHumanFactionTurnStart",<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;condition = function(context, nt)<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;return context:faction():name() == "wh3_main_ksl_the_ice_court"<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;end,<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;immediate = true<br />
					 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;{<br />
					 &emsp;&emsp;&emsp;&emsp;},<br />
					 &emsp;&emsp;&emsp;&emsp;nil,<br />
					 &emsp;&emsp;&emsp;&emsp;"CancelPlayerStartsTurnTen"<br />
					 );<br />
					 <br />
					 -- calling a function on the object once created<br />
					 nt_player_starts_turn_ten:start()<br />
				</code></div>
				<div class="section_body">
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_trigger:Querying"><h2 class="section_header">Querying</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:has_triggered_this_campaign"><h3 class="function_name"><strong><code>narrative_trigger:has_triggered_this_campaign()</code></strong></h3></a>
						</dt>
						<dd>
							Returns whether this narrative event has triggered in this campaign save.


							<h4>Returns:</h4>
							<ol>
								<li><code><code><a href="lua.html#class:boolean">boolean</a></code></code> has triggered</li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2215</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_trigger:Configuration"><h2 class="section_header">Configuration</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:add_monitor_event"><h3 class="function_name"><strong><code>narrative_trigger:add_monitor_event(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">event</i><code><strong>, <code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">condition</i><code><strong>, [<code><a href="lua.html#class:boolean">boolean</a></code> </strong></code><i class="parameter">trigger immediately</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Adds a event/condition monitor record to this narrative trigger. This should only be called after the creation of the narrative trigger, but before it is started with <code><a href="#function:narrative_trigger:start">narrative_trigger:start</a></code>.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Event name.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p>Condition function. This function will be called when the specified event is received, and will be passed the event context and the narrative trigger object as two arguments. It should return a value that evaluates to true if the condition passes, or otherwise if the condition fails.</p>
										<p>Alternatively the <code><a href="lua.html#class:boolean">boolean</a></code> value <code>true</code> may be supplied in place of a function, in which case the condition always passes.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:boolean">boolean</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=true</i></p>
										<p>Instructs the narrative trigger to fire its target messages immediately if this event/condition pair pass. If <code>false</code> is specified here, and it's a singleplayer game, the triggering of the target messages happens within an intervention.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2235</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:add_monitor_message"><h3 class="function_name"><strong><code>narrative_trigger:add_monitor_message(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">message</i><code><strong>, [<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">condition</i><code><strong>], [<code><a href="lua.html#class:boolean">boolean</a></code> </strong></code><i class="parameter">trigger immediately</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Adds a script message/condition monitor record to this narrative trigger. This should only be called after the creation of the narrative trigger, but before it is started with <code><a href="#function:narrative_trigger:start">narrative_trigger:start</a></code>.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>Message name.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Condition function. This function will be called when the specified message is received, and will be passed the message context and the narrative trigger object as two arguments. It should return a value that evaluates to true if the condition passes, or otherwise if the condition fails.</p>
										<p>Alternatively the <code><a href="lua.html#class:boolean">boolean</a></code> value <code>true</code> may be supplied in place of a function, in which case the condition always passes.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>3</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:boolean">boolean</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=true</i></p>
										<p>Instructs the narrative trigger to fire its target messages immediately if this event/condition pair pass. If <code>false</code> is specified here, and it's a singleplayer game, the triggering of the target messages happens within an intervention.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2275</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:set_should_setup_cancel_listeners_with_start_listeners"><h3 class="function_name"><strong><code>narrative_trigger:set_should_setup_cancel_listeners_with_start_listeners([<code><a href="lua.html#class:boolean">boolean</a></code> </strong></code><i class="parameter">value</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Sets whether the narrative trigger should start cancel message listeners with start message listeners. If the narrative trigger is set up with both start messages and cancel messages, then by default the cancel message listeners are not started until the start messages are received. Use this function to change this behaviour and allow the narrative trigger to be cancelled before a start message is received.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:boolean">boolean</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=true</i></p>
										<p>value</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2315</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:add_start_callback"><h3 class="function_name"><strong><code>narrative_trigger:add_start_callback(<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">calllback</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a start callback to the narrative trigger. This will be called when the narrative trigger starts its main monitoring processes, either when the start message is received or on startup (if no start message was specified). If the game is saved and reloaded at this point, causing the main monitors to be restarted, then any start callbacks are called again.<br />
							A boolean flag will be passed to any start functions to indicate whether the main monitors are being started from a savegame. If the main monitors are not being started from a savegame then it means a start message has just been received - in this case the start message string is supplied to each callback as a second argument.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p>calllback</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2333</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:add_stop_callback"><h3 class="function_name"><strong><code>narrative_trigger:add_stop_callback(<code><a href="lua.html#class:function">function</a></code> </strong></code><i class="parameter">calllback</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Adds a stop callback to the narrative trigger. This will be called when the narrative trigger stops its main monitoring processes, either when a main monitor is satisfied and fires the target message(s), or when a cancel event is received while the main monitors are running. Each stop callback will be passed a flag to indicate whether the narrative trigger's target messages were fired.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:function">function</a></code></code></p>
									</td>
									<td>
										<p>calllback</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2346</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_trigger:Starting"><h2 class="section_header">Starting</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:start"><h3 class="function_name"><strong><code>narrative_trigger:start()</code></strong></h3></a>
						</dt>
						<dd>
							Start the narrative trigger. If any start messages have been registered with the narrative trigger then a listener for these is started, otherwise the main event/condition listeners are started.<br />
							Some main monitor records must have been added to the narrative trigger prior to this function being called, either during construction (see <code><a href="#function:narrative_trigger:new">narrative_trigger:new</a></code>) or afterwards with <code><a href="#function:narrative_trigger:add_monitor_event">narrative_trigger:add_monitor_event</a></code> or <code><a href="#function:narrative_trigger:add_monitor_message">narrative_trigger:add_monitor_message</a></code>.


							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2385</p>
						</dd>
					</dl>
				</div>


				<div>
					<a style="float:right;" href="#top">Back to top</a>
					<a name="section:narrative_trigger:Manipulation"><h2 class="section_header">Manipulation</h2></a>
				</div>
				<div class="section_body">
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:trigger_message"><h3 class="function_name"><strong><code>narrative_trigger:trigger_message(<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">message</i><code><strong>)</code></strong></h3></a>
						</dt>
						<dd>
							Force this narrative trigger to trigger a message, associated with the faction related to this narrative trigger.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p>message</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2737</p>
						</dd>
					</dl>
					<dl class="function">
						<dt>
							<a name="function:narrative_trigger:force_main_trigger"><h3 class="function_name"><strong><code>narrative_trigger:force_main_trigger([<code><a href="lua.html#class:string">string</a></code> </strong></code><i class="parameter">reason</i><code><strong>], [<code><a href="lua.html#class:boolean">boolean</a></code> </strong></code><i class="parameter">immediate</i><code><strong>])</code></strong></h3></a>
						</dt>
						<dd>
							Instruct this narrative trigger to act as if one of its main monitors has been triggered. The narrative trigger must be in the correct phase, where its main monitors are active. A reason string may be supplied for output purposes.

							<h4>Parameters:</h4>
							<table class="parameter_list">
								<colgroup>
									<col style="width: 3%;">
									<col style="width: 12%;">
									<col style="width: 85%;">
								</colgroup>
								<tr>
									<td>
										<p><strong>1</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:string">string</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=nil</i></p>
										<p>Reason string.</p>
									</td>
								</tr>
								<tr>
									<td>
										<p><strong>2</strong></p>
									</td>
									<td>
										<p><code><code><a href="lua.html#class:boolean">boolean</a></code></code></p>
									</td>
									<td>
										<p><i>optional, default value=true</i></p>
										<p>Force the narrative trigger to trigger its target messages immediately. If this is set to <code>false</code>, and it's a singleplayer game, then the narrative trigger will trigger the target messages within an intervention.</p>
									</td>
								</tr>
							</table>

							<h4>Returns:</h4>
							<ol>
								<li><code>nil</code></li>
							</ol>
							<p class="file_comment">defined in ../../Warhammer/working_data/script/_lib/lib_campaign_narrative_events.lua, line 2745</p>
						</dd>
					</dl>
				</div>


			</div>

		</div>

		<div id="about">Last updated 12/08/2022 11:56:57</div>

	</div>

	<script src="../searchdata.js"></script>
	<script src="../search.js"></script>
	<script>const page_env = "campaign"; const path_to_document_root = "../";</script>

</body>
</html>